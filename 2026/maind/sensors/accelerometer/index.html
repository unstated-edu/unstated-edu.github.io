<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tilt Phone (Devicemotion)</title>
    <style>
      body {
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #111;
        color: #fff;
        font-family: system-ui;
      }
      .scene {
        perspective: 900px;
        margin: 14px 0;
      }
      .phone {
        width: 120px;
        height: 220px;
        border-radius: 22px;
        border: 3px solid #fff;
        background: #222;
        transform-style: preserve-3d;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      }
      #values {
        font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
        text-align: center;
        opacity: 0.9;
      }
      button {
        padding: 10px 16px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <button id="start">Enable motion</button>

    <div class="scene">
      <div class="phone" id="phone"></div>
    </div>

    <div id="values">waiting…</div>

    <script>
      const phone = document.getElementById("phone");
      const values = document.getElementById("values");
      const btn = document.getElementById("start");

      let listening = false;
      let rotX = 0,
        rotY = 0;

      function apply(x, y) {
        // smoothing
        const a = 0.15;
        rotX = rotX * (1 - a) + x * a;
        rotY = rotY * (1 - a) + y * a;
        phone.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
      }

      function onMotion(e) {
        const a = e.accelerationIncludingGravity;
        if (!a) return;

        const ax = a.x ?? 0;
        const ay = a.y ?? 0;
        const az = a.z ?? 0;

        // Compute tilt from gravity vector:
        // pitch (front/back), roll (left/right)
        const pitch =
          Math.atan2(ax, Math.sqrt(ay * ay + az * az)) * (180 / Math.PI);
        const roll = Math.atan2(ay, az) * (180 / Math.PI);

        // Feel more natural as a “phone in hand”
        apply(pitch, -roll);

        values.innerHTML =
          `ax: ${ax.toFixed(2)}<br>` +
          `ay: ${ay.toFixed(2)}<br>` +
          `az: ${az.toFixed(2)}<br><br>` +
          `pitch: ${pitch.toFixed(1)}°<br>` +
          `roll: ${roll.toFixed(1)}°`;
      }

      async function enable() {
        try {
          // iOS permission
          if (
            typeof DeviceMotionEvent !== "undefined" &&
            typeof DeviceMotionEvent.requestPermission === "function"
          ) {
            const res = await DeviceMotionEvent.requestPermission();
            if (res !== "granted") throw new Error("Permission denied");
          }

          if (!listening) {
            window.addEventListener("devicemotion", onMotion, true);
            listening = true;
          }

          btn.disabled = true;
          btn.textContent = "Motion enabled";
        } catch (err) {
          values.textContent = "Permission denied / motion not available.";
          console.error(err);
        }
      }

      btn.addEventListener("click", enable);
    </script>
  </body>
</html>
